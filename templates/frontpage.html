{% extends "baseSideBar.html" %}
{% load static %}

{% block content %}

<div id="map-container" class="container-fluid">
     <div id="map">

         <script>

             var eventMap = L.map('map').setView([63.429722, 10.393333], 13);
         L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4NXVycTA2emYycXBndHRqcmZ3N3gifQ.rJcFIG214AriISLbB6B5aw', {
            maxZoom: 18,
            attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, ' +
                '<a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, ' +
                'Imagery Â© <a href="http://mapbox.com">Mapbox</a>',
            id: 'mapbox.streets'
        }).addTo(eventMap);</script>

     </div>
 </div>


<script>
    var layer;
    var markerLayer = new L.featureGroup();

    eventMap.locate({setView:true}).on('locationfound',function (e) {
        eventMap.setZoom(13);
    });


</script>

    <script type="text/javascript">

    function onEachFeature(feature, layer) {
        var ourPopup = "<h4>" + feature.properties.title + "" + '<br>' + '<p>' + '<a href="{% url 'events:event_detail' 55 %}">See more</a>'.replace(/55/, feature.properties.pk.toString()) ;
        var marker = L.marker(layer.getLatLng(), {icon: greenIcon});
        marker.bindPopup(ourPopup);
        markerLayer.addLayer(marker);
    }

    var greenIcon = L.icon({
    iconUrl: '{% static "img/icons/leaf-green.png" %}',
    shadowUrl: '{% static "img/icons/leaf-shadow.png" %}',

    iconSize:     [38, 95], // size of the icon
    shadowSize:   [50, 64], // size of the shadow
    iconAnchor:   [22, 94], // point of the icon which will correspond to marker's location
    shadowAnchor: [4, 62],  // the same for the shadow
    popupAnchor:  [-3, -76] // point from which the popup should open relative to the iconAnchor
    });

    function addEvents(map) {
        var EventPoints = "{% url 'events:pointData' %}";

        $.getJSON(EventPoints, function (data) {
            //L.geoJSON(data).addTo(map);
            layer = L.geoJson(data, {
                onEachFeature: onEachFeature
            });
            markerLayer.addTo(eventMap);
            console.log(layer);
        });

    }

    addEvents(eventMap);

</script>

{% endblock content %}
